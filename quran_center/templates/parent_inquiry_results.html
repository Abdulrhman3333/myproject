{% extends "base.html" %}
{% load static %}
{% block title %}Ø­Ù„Ù‚Ø§Øª Ø¬Ø§Ù…Ø¹ Ø§Ù„Ø­Ù…ÙˆØ¯ÙŠ - Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡{% endblock %}

{% block content %}
<div class="page-hero">
    <div class="page-hero-inner">
        <h1 class="page-hero-title">ØªÙ‚Ø±ÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø¨Ù†Ø§Ø¡</h1>
        <p class="page-hero-subtitle">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„: {{ parent_phone }}</p>
    </div>
</div>

{% if students %}
    <div class="row">
        {% for student in students %}
        <div class="col-lg-6 mb-4">
            <div class="card shadow-lg" style="border-top: 4px solid #0ea5e9;">
                <div class="card-header" style="background: linear-gradient(90deg, #0ea5e9 0%, #0284c7 100%); color: white;">
                    <h5 style="margin: 0; font-family: 'El Messiri', serif; font-size: 1.3rem;">{{ student.full_name }}</h5>
                    <small style="opacity: 0.9;">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: <strong>{{ student.educational_stage }}</strong></small>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <p style="margin: 0.3rem 0;"><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…:</strong> {{ student.teacher.username }}</p>
                        {% if student.teacher_phone %}
                        <p style="margin: 0.3rem 0;"><strong>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ù„Ù…:</strong> {{ student.teacher_phone }}</p>
                        <a href="https://wa.me/966{{ student.teacher_phone|slice:'1:' }}?text=Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ØŒ Ø£ÙˆØ¯ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¨Ø®ØµÙˆØµ Ø§Ù„Ø·Ø§Ù„Ø¨ {{ student.full_name }}" target="_blank" class="btn btn-sm btn-success" style="margin-top: 0.5rem; display: inline-block;">
                            ğŸ’¬ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù… Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
                        </a>
                        {% endif %}                        
                        <p style="margin: 0.3rem 0;"><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span class="badge bg-success">{{ student.status }}</span></p>
                    </div>

                    <hr>

                    <div class="mb-3">
                        <h6 style="font-family: 'El Messiri', serif; margin-bottom: 1rem; color: #5B8FBE;">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¶ÙˆØ±</h6>
                        <div class="row text-center">
                            <div class="col-6 col-md-3">
                                <small class="text-muted">Ø­Ø§Ø¶Ø±</small>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">{{ student.present_count }}</div>
                            </div>
                            <div class="col-6 col-md-3">
                                <small class="text-muted">ØºØ§Ø¦Ø¨</small>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #ef4444;">{{ student.absent_count }}</div>
                            </div>
                            <div class="col-6 col-md-3">
                                <small class="text-muted">Ù…Ø³ØªØ£Ø°Ù†</small>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #f59e0b;">{{ student.excused_count }}</div>
                            </div>
                            <div class="col-6 col-md-3">
                                <small class="text-muted">Ù…ØªØ£Ø®Ø±</small>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #8b5cf6;">{{ student.late_count }}</div>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div>
                        <h6 style="font-family: 'El Messiri', serif; margin-bottom: 1rem; color: #5B8FBE;">ğŸ“… Ø¢Ø®Ø± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</h6>
                        {% if student.recent_attendance %}
                            <div class="table-responsive">
                                <table class="table table-sm table-striped" style="font-size: 0.9rem;">
                                    <thead style="background-color: #f3f4f6;">
                                        <tr>
                                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for attendance in student.recent_attendance %}
                                        <tr>
                                            <td>{{ attendance.date|date:"Y-m-d" }}</td>
                                            <td>
                                                {% if attendance.status == "Ø­Ø§Ø¶Ø±" %}
                                                    <span class="badge bg-success">{{ attendance.status }}</span>
                                                {% elif attendance.status == "ØºØ§Ø¦Ø¨" %}
                                                    <span class="badge bg-danger">{{ attendance.status }}</span>
                                                {% elif attendance.status == "Ù…Ø³ØªØ£Ø°Ù†" %}
                                                    <span class="badge bg-warning text-dark">{{ attendance.status }}</span>
                                                {% elif attendance.status == "Ù…ØªØ£Ø®Ø±" %}
                                                    <span class="badge bg-purple" style="background-color: #8b5cf6;">{{ attendance.status }}</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <p class="text-muted" style="text-align: center; margin: 0;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­Ø¶ÙˆØ± Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        <h4 class="alert-heading">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø¨Ù†Ø§Ø¡</h4>
        <p>Ù„Ù… Ù†Ø¬Ø¯ Ø£ÙŠ Ø£Ø¨Ù†Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø§Ù„Ø°ÙŠ Ø£Ø¯Ø®Ù„ØªÙ‡.</p>
        <hr>
        <p class="mb-0">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>
    </div>
{% endif %}

<div class="text-center mt-4">
    <a href="{% url 'parent_inquiry' %}" class="btn btn-primary">Ø¨Ø­Ø« Ø¬Ø¯ÙŠØ¯</a>
    <a href="{% url 'welcome' %}" class="btn btn-outline-secondary">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
</div>
{% endblock %}
